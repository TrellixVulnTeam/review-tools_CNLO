= Test --state-output
Running: snap-review --state-output=./out
./tests/hello-world_25.snap: pass
out:
{
  "format": 1
}

= Test --state-input/--state-output
Running: snap-review --state-input=./in --state-output=./out
./tests/hello-world_25.snap: pass
in:
{
  "format": 1
}
out:
{
  "format": 1
}

= Test --state-input only
Running: snap-review --state-input=./in
ERROR: Must specify --state-output with --state-input
in:
{
  "format": 1
}

= Test --state-input=nonexistent/--state-output
Running: snap-review --state-input=/nonexistent --state-output=./out
ERROR: file '/nonexistent' does not exist.

= Test --state-input=<invalid>/--state-output
Running: snap-review --state-input=./in --state-output=./out
ERROR: state-input failed to verify: 'format' should be a positive JSON integer <= 1
in:
{
  "format": 0
}

= Test --state-input=<eperm>/--state-output
Running: snap-review --state-input=./in --state-output=./out
ERROR: Could not read state input: [Errno 13] Permission denied: './in'

= Test --state-output=<eperm>
Running: snap-review --state-output=./not-allowed/out
Errors
------
 - state-output-write
	Could not write state output: [Errno 13] Permission denied: './not-allowed/out'
./tests/hello-world_25.snap: FAIL

= Test --state-output
Running: snap-review --json --state-output=./out
{
  "snap.v2_declaration": {
    "error": {},
    "info": {},
    "warn": {}
  },
  "snap.v2_functional": {
    "error": {},
    "info": {
      "functional-snap-v2:execstack": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_lint": {
    "error": {},
    "info": {
      "lint-snap-v2:apps": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:architecture_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:assumes_valid": {
        "manual_review": false,
        "text": "OK (assumes not specified)"
      },
      "lint-snap-v2:cli_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:external_symlinks": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:hooks_present": {
        "manual_review": false,
        "text": "OK (optional hooks field not specified)"
      },
      "lint-snap-v2:iffy_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:name_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_redflag": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:title_present": {
        "manual_review": false,
        "text": "OK (optional title field not specified)"
      },
      "lint-snap-v2:unknown_field": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_install_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_refresh_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_stop_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_contents_for_architecture": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_unicode": {
        "manual_review": false,
        "text": "ok"
      },
      "lint-snap-v2:vcs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:version_valid": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_security": {
    "error": {},
    "info": {
      "security-snap-v2:profile_name_length:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:env": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_repack_checksum": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  }
}
out:
{
  "format": 1
}

= Test --state-input/--state-output
Running: snap-review --json --state-input=./in --state-output=./out
{
  "snap.v2_declaration": {
    "error": {},
    "info": {},
    "warn": {}
  },
  "snap.v2_functional": {
    "error": {},
    "info": {
      "functional-snap-v2:execstack": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_lint": {
    "error": {},
    "info": {
      "lint-snap-v2:apps": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:architecture_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:assumes_valid": {
        "manual_review": false,
        "text": "OK (assumes not specified)"
      },
      "lint-snap-v2:cli_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:external_symlinks": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:hooks_present": {
        "manual_review": false,
        "text": "OK (optional hooks field not specified)"
      },
      "lint-snap-v2:iffy_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:name_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_redflag": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:title_present": {
        "manual_review": false,
        "text": "OK (optional title field not specified)"
      },
      "lint-snap-v2:unknown_field": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_install_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_refresh_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_stop_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_contents_for_architecture": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_unicode": {
        "manual_review": false,
        "text": "ok"
      },
      "lint-snap-v2:vcs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:version_valid": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_security": {
    "error": {},
    "info": {
      "security-snap-v2:profile_name_length:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:env": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_repack_checksum": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  }
}
in:
{
  "format": 1
}
out:
{
  "format": 1
}

= Test --state-input only
Running: snap-review --json --state-input=./in
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "Must specify --state-output with --state-input"
      }
    },
    "info": {},
    "warn": {}
  }
}
in:
{
  "format": 1
}

= Test --state-input=nonexistent/--state-output
Running: snap-review --json --state-input=/nonexistent --state-output=./out
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "file '/nonexistent' does not exist."
      }
    },
    "info": {},
    "warn": {}
  }
}

= Test --state-input=<invalid>/--state-output
Running: snap-review --json --state-input=./in --state-output=./out
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "state-input failed to verify: 'format' should be a positive JSON integer <= 1"
      }
    },
    "info": {},
    "warn": {}
  }
}
in:
{
  "format": 0
}

= Test --state-input=<eperm>/--state-output
Running: snap-review --json --state-input=./in --state-output=./out
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "Could not read state input: [Errno 13] Permission denied: './in'"
      }
    },
    "info": {},
    "warn": {}
  }
}

= Test --state-output=<eperm>
Running: snap-review --json --state-output=./not-allowed/out
{
  "runtime-errors": {
    "error": {
      "state-output-write": {
        "manual_review": false,
        "text": "Could not write state output: [Errno 13] Permission denied: './not-allowed/out'"
      }
    },
    "info": {},
    "warn": {}
  },
  "snap.v2_declaration": {
    "error": {},
    "info": {},
    "warn": {}
  },
  "snap.v2_functional": {
    "error": {},
    "info": {
      "functional-snap-v2:execstack": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_lint": {
    "error": {},
    "info": {
      "lint-snap-v2:apps": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_entry:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:apps_unknown:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:architecture_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:assumes_valid": {
        "manual_review": false,
        "text": "OK (assumes not specified)"
      },
      "lint-snap-v2:cli_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:cli_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:command:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:env": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:daemon_required:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:external_symlinks": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:hooks_present": {
        "manual_review": false,
        "text": "OK (optional hooks field not specified)"
      },
      "lint-snap-v2:iffy_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:name_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_redflag": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:title_present": {
        "manual_review": false,
        "text": "OK (optional title field not specified)"
      },
      "lint-snap-v2:unknown_field": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_install_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_refresh_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:unknown_stop_mode": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_contents_for_architecture": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_unicode": {
        "manual_review": false,
        "text": "ok"
      },
      "lint-snap-v2:vcs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:version_valid": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_security": {
    "error": {},
    "info": {
      "security-snap-v2:profile_name_length:echo": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:env": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:evil": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:sh": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:showdev": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:profile_name_length:usehw": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_repack_checksum": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  }
}

= Test --state-output
Running: snap-review --sdk --state-output=./out
= snap.v2_declaration =
{
  "error": {},
  "info": {},
  "warn": {}
}
= snap.v2_functional =
{
  "error": {},
  "info": {
    "functional-snap-v2:execstack": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_lint =
{
  "error": {},
  "info": {
    "lint-snap-v2:apps": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:architecture_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:assumes_valid": {
      "manual_review": false,
      "text": "OK (assumes not specified)"
    },
    "lint-snap-v2:cli_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:external_symlinks": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:hooks_present": {
      "manual_review": false,
      "text": "OK (optional hooks field not specified)"
    },
    "lint-snap-v2:iffy_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:name_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_redflag": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:title_present": {
      "manual_review": false,
      "text": "OK (optional title field not specified)"
    },
    "lint-snap-v2:unknown_field": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_install_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_refresh_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_stop_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_contents_for_architecture": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_unicode": {
      "manual_review": false,
      "text": "ok"
    },
    "lint-snap-v2:vcs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:version_valid": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_security =
{
  "error": {},
  "info": {
    "security-snap-v2:profile_name_length:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:env": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_repack_checksum": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
out:
{
  "format": 1
}

= Test --state-input/--state-output
Running: snap-review --sdk --state-input=./in --state-output=./out
= snap.v2_declaration =
{
  "error": {},
  "info": {},
  "warn": {}
}
= snap.v2_functional =
{
  "error": {},
  "info": {
    "functional-snap-v2:execstack": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_lint =
{
  "error": {},
  "info": {
    "lint-snap-v2:apps": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:architecture_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:assumes_valid": {
      "manual_review": false,
      "text": "OK (assumes not specified)"
    },
    "lint-snap-v2:cli_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:external_symlinks": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:hooks_present": {
      "manual_review": false,
      "text": "OK (optional hooks field not specified)"
    },
    "lint-snap-v2:iffy_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:name_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_redflag": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:title_present": {
      "manual_review": false,
      "text": "OK (optional title field not specified)"
    },
    "lint-snap-v2:unknown_field": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_install_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_refresh_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_stop_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_contents_for_architecture": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_unicode": {
      "manual_review": false,
      "text": "ok"
    },
    "lint-snap-v2:vcs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:version_valid": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_security =
{
  "error": {},
  "info": {
    "security-snap-v2:profile_name_length:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:env": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_repack_checksum": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
in:
{
  "format": 1
}
out:
{
  "format": 1
}

= Test --state-input only
Running: snap-review --sdk --state-input=./in
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "Must specify --state-output with --state-input"
      }
    },
    "info": {},
    "warn": {}
  }
}
in:
{
  "format": 1
}

= Test --state-input=nonexistent/--state-output
Running: snap-review --sdk --state-input=/nonexistent --state-output=./out
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "file '/nonexistent' does not exist."
      }
    },
    "info": {},
    "warn": {}
  }
}

= Test --state-input=<invalid>/--state-output
Running: snap-review --sdk --state-input=./in --state-output=./out
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "state-input failed to verify: 'format' should be a positive JSON integer <= 1"
      }
    },
    "info": {},
    "warn": {}
  }
}
in:
{
  "format": 0
}

= Test --state-input=<eperm>/--state-output
Running: snap-review --sdk --state-input=./in --state-output=./out
{
  "runtime-errors": {
    "error": {
      "msg": {
        "manual_review": true,
        "text": "Could not read state input: [Errno 13] Permission denied: './in'"
      }
    },
    "info": {},
    "warn": {}
  }
}

= Test --state-output=<eperm>
Running: snap-review --sdk --state-output=./not-allowed/out
= runtime-errors =
{
  "error": {
    "state-output-write": {
      "manual_review": false,
      "text": "Could not write state output: [Errno 13] Permission denied: './not-allowed/out'"
    }
  },
  "info": {},
  "warn": {}
}
= snap.v2_declaration =
{
  "error": {},
  "info": {},
  "warn": {}
}
= snap.v2_functional =
{
  "error": {},
  "info": {
    "functional-snap-v2:execstack": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_lint =
{
  "error": {},
  "info": {
    "lint-snap-v2:apps": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_entry:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:apps_unknown:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:architecture_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:assumes_valid": {
      "manual_review": false,
      "text": "OK (assumes not specified)"
    },
    "lint-snap-v2:cli_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:cli_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:command:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:env": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:daemon_required:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:external_symlinks": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:hooks_present": {
      "manual_review": false,
      "text": "OK (optional hooks field not specified)"
    },
    "lint-snap-v2:iffy_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:name_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_redflag": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:title_present": {
      "manual_review": false,
      "text": "OK (optional title field not specified)"
    },
    "lint-snap-v2:unknown_field": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_install_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_refresh_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:unknown_stop_mode": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_contents_for_architecture": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_unicode": {
      "manual_review": false,
      "text": "ok"
    },
    "lint-snap-v2:vcs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:version_valid": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_security =
{
  "error": {},
  "info": {
    "security-snap-v2:profile_name_length:echo": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:env": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:evil": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:sh": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:showdev": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:profile_name_length:usehw": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_repack_checksum": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}

= Test unsquashfs -lln output with weird files
drwxr-xr-x 0/0                     215 2020-03-23 14:32 squashfs-root
drwxr-xr-x 0/0                      73 2020-03-23 14:23 squashfs-root/bin
-rwxr-xr-x 0/0                   43416 2020-03-23 14:23 squashfs-root/bin/cat
-rwxr-xr-x 0/0                  129816 2020-03-23 14:23 squashfs-root/bin/dash
-rwxr-xr-x 0/0                   39256 2020-03-23 14:23 squashfs-root/bin/false
-rwxr-xr-x 0/0                  142144 2020-03-23 14:23 squashfs-root/bin/ls
-rwxr-xr-x 0/0                   39256 2020-03-23 14:23 squashfs-root/bin/true
drwxr-xr-x 0/0                       3 2019-08-27 12:30 squashfs-root/dev
drwxr-xr-x 0/0                       3 2020-03-23 14:31 squashfs-root/etc
drwxr-xr-x 0/0                       3 2018-04-24 03:34 squashfs-root/home
drwxr-xr-x 0/0                      39 2020-03-23 14:16 squashfs-root/lib
drwxr-xr-x 0/0                     181 2020-03-23 14:27 squashfs-root/lib/x86_64-linux-gnu
-rwxr-xr-x 0/0                  191472 2020-03-14 18:21 squashfs-root/lib/x86_64-linux-gnu/ld-2.31.so
-rwxr-xr-x 0/0                 2029224 2020-03-23 14:24 squashfs-root/lib/x86_64-linux-gnu/libc-2.31.so
lrwxrwxrwx 0/0                      12 2020-03-14 18:21 squashfs-root/lib/x86_64-linux-gnu/libc.so.6 -> libc-2.31.so
-rw-r--r-- 0/0                   18816 2020-03-23 14:24 squashfs-root/lib/x86_64-linux-gnu/libdl-2.31.so
lrwxrwxrwx 0/0                      13 2020-03-14 18:21 squashfs-root/lib/x86_64-linux-gnu/libdl.so.2 -> libdl-2.31.so
-rwxr-xr-x 0/0                  157224 2020-03-14 18:21 squashfs-root/lib/x86_64-linux-gnu/libpthread-2.31.so
lrwxrwxrwx 0/0                      18 2020-03-14 18:21 squashfs-root/lib/x86_64-linux-gnu/libpthread.so.0 -> libpthread-2.31.so
-rw-r--r-- 0/0                  163200 2020-02-18 03:44 squashfs-root/lib/x86_64-linux-gnu/libselinux.so.1
drwxr-xr-x 0/0                      43 2020-03-23 14:25 squashfs-root/lib64
lrwxrwxrwx 0/0                      32 2020-03-14 18:21 squashfs-root/lib64/ld-linux-x86-64.so.2 -> /lib/x86_64-linux-gnu/ld-2.31.so
drwxr-xr-x 0/0                       3 2019-08-27 11:48 squashfs-root/media
drwxr-xr-x 0/0                      32 2020-03-23 14:02 squashfs-root/meta
-rw-r--r-- 0/0                     149 2020-03-23 14:02 squashfs-root/meta/snap.yaml
drwxr-xr-x 0/0                       3 2019-08-27 11:48 squashfs-root/opt
drwxr-xr-x 0/0                       3 2018-04-24 03:34 squashfs-root/proc
drwx------ 0/0                       3 2020-03-24 13:25 squashfs-root/root
drwxr-xr-x 0/0                       3 2020-03-23 14:09 squashfs-root/run
drwxr-xr-x 0/0                       3 2018-04-24 03:34 squashfs-root/sys
drwxrwxrwt 0/0                       3 2019-08-27 12:30 squashfs-root/tmp
drwxr-xr-x 0/0                      63 2020-03-23 14:35 squashfs-root/usr
drwxr-xr-x 0/0                      52 2020-03-23 14:35 squashfs-root/usr/lib
drwxr-xr-x 0/0                       3 2020-03-23 14:35 squashfs-root/usr/lib/snapd
drwxr-xr-x 0/0                      65 2020-03-23 14:26 squashfs-root/usr/lib/x86_64-linux-gnu
lrwxrwxrwx 0/0                      19 2019-12-07 11:06 squashfs-root/usr/lib/x86_64-linux-gnu/libpcre2-8.so.0 -> libpcre2-8.so.0.9.0
-rw-r--r-- 0/0                  584392 2019-12-07 11:06 squashfs-root/usr/lib/x86_64-linux-gnu/libpcre2-8.so.0.9.0
drwxr-xr-x 0/0                      28 2020-03-23 14:35 squashfs-root/usr/local
drwxr-xr-x 0/0                      28 2020-03-23 14:35 squashfs-root/usr/local/share
drwxr-xr-x 0/0                       3 2020-03-23 14:35 squashfs-root/usr/local/share/fonts
drwxr-xr-x 0/0                      40 2020-03-26 09:34 squashfs-root/usr/share
drwxr-xr-x 0/0                      75 2020-03-26 09:35 squashfs-root/usr/share/data
-rw-r--r-- 0/0                       0 2020-03-26 09:35 squashfs-root/usr/share/data/ file with many spaces 
-rw-r--r-- 0/0                       0 2020-03-26 09:34 squashfs-root/usr/share/data/file with smiley 😃
drwxr-xr-x 0/0                       3 2020-03-23 14:35 squashfs-root/usr/share/fonts
drwxr-xr-x 0/0                       3 2020-03-23 14:35 squashfs-root/usr/src
drwxr-xr-x 0/0                      73 2020-03-23 14:35 squashfs-root/var
drwxr-xr-x 0/0                      33 2020-03-23 14:35 squashfs-root/var/cache
drwxr-xr-x 0/0                       3 2020-03-23 14:35 squashfs-root/var/cache/fontconfig
drwxr-xr-x 0/0                      28 2020-03-23 14:10 squashfs-root/var/lib
drwxr-xr-x 0/0                       3 2020-03-23 14:10 squashfs-root/var/lib/snapd
drwxr-xr-x 0/0                       3 2019-08-27 12:30 squashfs-root/var/log
drwxr-xr-x 0/0                       3 2020-03-23 14:35 squashfs-root/var/snap
drwxrwxrwt 0/0                       3 2019-08-27 11:50 squashfs-root/var/tmp
drwxr-xr-x 0/0                       3 2019-08-27 12:30 squashfs-root/writable

= Test --state-output=base.last test-state-base_1_amd64.snap
Running: snap-review --state-output=./base.last
Errors
------
 - lint-snap-v2:snap_type_redflag
	(NEEDS REVIEW) type 'base' not allowed
./tests/test-state-base_1_amd64.snap: FAIL

= Test --state-input=base.last --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --state-input=./base.last --state-output=./base.current
Errors
------
 - lint-snap-v2:snap_type_redflag
	(NEEDS REVIEW) type 'base' not allowed
./tests/test-state-base_1_amd64.snap: FAIL

= Test --state-input=base.missing-cp --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --state-input=./base.missing-cp --state-output=./base.current
Errors
------
 - lint-snap-v2:snap_type_redflag
	(NEEDS REVIEW) type 'base' not allowed
Warnings
--------
 - functional-snap-v2:state_base_files:missing
	missing files since last review: ./bin/cp
./tests/test-state-base_1_amd64.snap: FAIL

= Test --state-input=base.missing-symbol --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --state-input=./base.missing-symbol --state-output=./base.current
Errors
------
 - lint-snap-v2:snap_type_redflag
	(NEEDS REVIEW) type 'base' not allowed
Warnings
--------
 - functional-snap-v2:state_base_files:symbols:missing
	missing symbols since last review: ./lib/x86_64-linux-gnu/libc-2.31.so (foo@@GLIBC_2.2.5)
./tests/test-state-base_1_amd64.snap: FAIL

= Test --state-output=base.last test-state-base_1_amd64.snap
Running: snap-review --json --state-output=./base.last
{
  "snap.v2_declaration": {
    "error": {},
    "info": {},
    "warn": {}
  },
  "snap.v2_functional": {
    "error": {},
    "info": {
      "functional-snap-v2:base_mountpoints": {
        "manual_review": false,
        "text": "OK"
      },
      "functional-snap-v2:state_base_files": {
        "manual_review": false,
        "text": "OK (no previous state)"
      }
    },
    "warn": {}
  },
  "snap.v2_lint": {
    "error": {
      "lint-snap-v2:snap_type_redflag": {
        "manual_review": true,
        "text": "(NEEDS REVIEW) type 'base' not allowed"
      }
    },
    "info": {
      "lint-snap-v2:apps_present": {
        "manual_review": false,
        "text": "OK (optional apps field not specified)"
      },
      "lint-snap-v2:architecture_specified_needed:amd64": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:architecture_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:assumes_valid": {
        "manual_review": false,
        "text": "OK (assumes not specified)"
      },
      "lint-snap-v2:base_interfaces:plugs": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:base_interfaces:slots": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:grade_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:hooks_present": {
        "manual_review": false,
        "text": "OK (optional hooks field not specified)"
      },
      "lint-snap-v2:iffy_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:name_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:title_present": {
        "manual_review": false,
        "text": "OK (optional title field not specified)"
      },
      "lint-snap-v2:unknown_field": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_unicode": {
        "manual_review": false,
        "text": "ok"
      },
      "lint-snap-v2:vcs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:version_valid": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_security": {
    "error": {},
    "info": {
      "security-snap-v2:squashfs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_repack_checksum": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  }
}

= Test --state-input=base.last --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --json --state-input=./base.last --state-output=./base.current
{
  "snap.v2_declaration": {
    "error": {},
    "info": {},
    "warn": {}
  },
  "snap.v2_functional": {
    "error": {},
    "info": {
      "functional-snap-v2:base_mountpoints": {
        "manual_review": false,
        "text": "OK"
      },
      "functional-snap-v2:state_base_files": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_lint": {
    "error": {
      "lint-snap-v2:snap_type_redflag": {
        "manual_review": true,
        "text": "(NEEDS REVIEW) type 'base' not allowed"
      }
    },
    "info": {
      "lint-snap-v2:apps_present": {
        "manual_review": false,
        "text": "OK (optional apps field not specified)"
      },
      "lint-snap-v2:architecture_specified_needed:amd64": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:architecture_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:assumes_valid": {
        "manual_review": false,
        "text": "OK (assumes not specified)"
      },
      "lint-snap-v2:base_interfaces:plugs": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:base_interfaces:slots": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:grade_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:hooks_present": {
        "manual_review": false,
        "text": "OK (optional hooks field not specified)"
      },
      "lint-snap-v2:iffy_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:name_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:title_present": {
        "manual_review": false,
        "text": "OK (optional title field not specified)"
      },
      "lint-snap-v2:unknown_field": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_unicode": {
        "manual_review": false,
        "text": "ok"
      },
      "lint-snap-v2:vcs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:version_valid": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_security": {
    "error": {},
    "info": {
      "security-snap-v2:squashfs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_repack_checksum": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  }
}

= Test --state-input=base.missing-cp --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --json --state-input=./base.missing-cp --state-output=./base.current
{
  "snap.v2_declaration": {
    "error": {},
    "info": {},
    "warn": {}
  },
  "snap.v2_functional": {
    "error": {},
    "info": {
      "functional-snap-v2:base_mountpoints": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {
      "functional-snap-v2:state_base_files:missing": {
        "manual_review": false,
        "text": "missing files since last review: ./bin/cp"
      }
    }
  },
  "snap.v2_lint": {
    "error": {
      "lint-snap-v2:snap_type_redflag": {
        "manual_review": true,
        "text": "(NEEDS REVIEW) type 'base' not allowed"
      }
    },
    "info": {
      "lint-snap-v2:apps_present": {
        "manual_review": false,
        "text": "OK (optional apps field not specified)"
      },
      "lint-snap-v2:architecture_specified_needed:amd64": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:architecture_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:assumes_valid": {
        "manual_review": false,
        "text": "OK (assumes not specified)"
      },
      "lint-snap-v2:base_interfaces:plugs": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:base_interfaces:slots": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:grade_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:hooks_present": {
        "manual_review": false,
        "text": "OK (optional hooks field not specified)"
      },
      "lint-snap-v2:iffy_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:name_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:title_present": {
        "manual_review": false,
        "text": "OK (optional title field not specified)"
      },
      "lint-snap-v2:unknown_field": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_unicode": {
        "manual_review": false,
        "text": "ok"
      },
      "lint-snap-v2:vcs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:version_valid": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_security": {
    "error": {},
    "info": {
      "security-snap-v2:squashfs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_repack_checksum": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  }
}

= Test --state-input=base.missing-symbol --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --json --state-input=./base.missing-symbol --state-output=./base.current
{
  "snap.v2_declaration": {
    "error": {},
    "info": {},
    "warn": {}
  },
  "snap.v2_functional": {
    "error": {},
    "info": {
      "functional-snap-v2:base_mountpoints": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {
      "functional-snap-v2:state_base_files:symbols:missing": {
        "manual_review": false,
        "text": "missing symbols since last review: ./lib/x86_64-linux-gnu/libc-2.31.so (foo@@GLIBC_2.2.5)"
      }
    }
  },
  "snap.v2_lint": {
    "error": {
      "lint-snap-v2:snap_type_redflag": {
        "manual_review": true,
        "text": "(NEEDS REVIEW) type 'base' not allowed"
      }
    },
    "info": {
      "lint-snap-v2:apps_present": {
        "manual_review": false,
        "text": "OK (optional apps field not specified)"
      },
      "lint-snap-v2:architecture_specified_needed:amd64": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:architecture_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:assumes_valid": {
        "manual_review": false,
        "text": "OK (assumes not specified)"
      },
      "lint-snap-v2:base_interfaces:plugs": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:base_interfaces:slots": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:description_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:grade_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:hooks_present": {
        "manual_review": false,
        "text": "OK (optional hooks field not specified)"
      },
      "lint-snap-v2:iffy_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:name_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:snap_type_valid": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:summary_present": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:title_present": {
        "manual_review": false,
        "text": "OK (optional title field not specified)"
      },
      "lint-snap-v2:unknown_field": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:valid_unicode": {
        "manual_review": false,
        "text": "ok"
      },
      "lint-snap-v2:vcs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "lint-snap-v2:version_valid": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  },
  "snap.v2_security": {
    "error": {},
    "info": {
      "security-snap-v2:squashfs_files": {
        "manual_review": false,
        "text": "OK"
      },
      "security-snap-v2:squashfs_repack_checksum": {
        "manual_review": false,
        "text": "OK"
      }
    },
    "warn": {}
  }
}

= Test --state-output=base.last test-state-base_1_amd64.snap
Running: snap-review --sdk --state-output=./base.last
= snap.v2_declaration =
{
  "error": {},
  "info": {},
  "warn": {}
}
= snap.v2_functional =
{
  "error": {},
  "info": {
    "functional-snap-v2:base_mountpoints": {
      "manual_review": false,
      "text": "OK"
    },
    "functional-snap-v2:state_base_files": {
      "manual_review": false,
      "text": "OK (no previous state)"
    }
  },
  "warn": {}
}
= snap.v2_lint =
{
  "error": {
    "lint-snap-v2:snap_type_redflag": {
      "manual_review": true,
      "text": "(NEEDS REVIEW) type 'base' not allowed"
    }
  },
  "info": {
    "lint-snap-v2:apps_present": {
      "manual_review": false,
      "text": "OK (optional apps field not specified)"
    },
    "lint-snap-v2:architecture_specified_needed:amd64": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:architecture_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:assumes_valid": {
      "manual_review": false,
      "text": "OK (assumes not specified)"
    },
    "lint-snap-v2:base_interfaces:plugs": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:base_interfaces:slots": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:grade_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:hooks_present": {
      "manual_review": false,
      "text": "OK (optional hooks field not specified)"
    },
    "lint-snap-v2:iffy_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:name_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:title_present": {
      "manual_review": false,
      "text": "OK (optional title field not specified)"
    },
    "lint-snap-v2:unknown_field": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_unicode": {
      "manual_review": false,
      "text": "ok"
    },
    "lint-snap-v2:vcs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:version_valid": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_security =
{
  "error": {},
  "info": {
    "security-snap-v2:squashfs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_repack_checksum": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}

= Test --state-input=base.last --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --sdk --state-input=./base.last --state-output=./base.current
= snap.v2_declaration =
{
  "error": {},
  "info": {},
  "warn": {}
}
= snap.v2_functional =
{
  "error": {},
  "info": {
    "functional-snap-v2:base_mountpoints": {
      "manual_review": false,
      "text": "OK"
    },
    "functional-snap-v2:state_base_files": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_lint =
{
  "error": {
    "lint-snap-v2:snap_type_redflag": {
      "manual_review": true,
      "text": "(NEEDS REVIEW) type 'base' not allowed"
    }
  },
  "info": {
    "lint-snap-v2:apps_present": {
      "manual_review": false,
      "text": "OK (optional apps field not specified)"
    },
    "lint-snap-v2:architecture_specified_needed:amd64": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:architecture_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:assumes_valid": {
      "manual_review": false,
      "text": "OK (assumes not specified)"
    },
    "lint-snap-v2:base_interfaces:plugs": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:base_interfaces:slots": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:grade_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:hooks_present": {
      "manual_review": false,
      "text": "OK (optional hooks field not specified)"
    },
    "lint-snap-v2:iffy_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:name_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:title_present": {
      "manual_review": false,
      "text": "OK (optional title field not specified)"
    },
    "lint-snap-v2:unknown_field": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_unicode": {
      "manual_review": false,
      "text": "ok"
    },
    "lint-snap-v2:vcs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:version_valid": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_security =
{
  "error": {},
  "info": {
    "security-snap-v2:squashfs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_repack_checksum": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}

= Test --state-input=base.missing-cp --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --sdk --state-input=./base.missing-cp --state-output=./base.current
= snap.v2_declaration =
{
  "error": {},
  "info": {},
  "warn": {}
}
= snap.v2_functional =
{
  "error": {},
  "info": {
    "functional-snap-v2:base_mountpoints": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {
    "functional-snap-v2:state_base_files:missing": {
      "manual_review": false,
      "text": "missing files since last review: ./bin/cp"
    }
  }
}
= snap.v2_lint =
{
  "error": {
    "lint-snap-v2:snap_type_redflag": {
      "manual_review": true,
      "text": "(NEEDS REVIEW) type 'base' not allowed"
    }
  },
  "info": {
    "lint-snap-v2:apps_present": {
      "manual_review": false,
      "text": "OK (optional apps field not specified)"
    },
    "lint-snap-v2:architecture_specified_needed:amd64": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:architecture_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:assumes_valid": {
      "manual_review": false,
      "text": "OK (assumes not specified)"
    },
    "lint-snap-v2:base_interfaces:plugs": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:base_interfaces:slots": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:grade_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:hooks_present": {
      "manual_review": false,
      "text": "OK (optional hooks field not specified)"
    },
    "lint-snap-v2:iffy_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:name_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:title_present": {
      "manual_review": false,
      "text": "OK (optional title field not specified)"
    },
    "lint-snap-v2:unknown_field": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_unicode": {
      "manual_review": false,
      "text": "ok"
    },
    "lint-snap-v2:vcs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:version_valid": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_security =
{
  "error": {},
  "info": {
    "security-snap-v2:squashfs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_repack_checksum": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}

= Test --state-input=base.missing-symbol --state-output=base.current test-state-base_1_amd64.snap
Running: snap-review --sdk --state-input=./base.missing-symbol --state-output=./base.current
= snap.v2_declaration =
{
  "error": {},
  "info": {},
  "warn": {}
}
= snap.v2_functional =
{
  "error": {},
  "info": {
    "functional-snap-v2:base_mountpoints": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {
    "functional-snap-v2:state_base_files:symbols:missing": {
      "manual_review": false,
      "text": "missing symbols since last review: ./lib/x86_64-linux-gnu/libc-2.31.so (foo@@GLIBC_2.2.5)"
    }
  }
}
= snap.v2_lint =
{
  "error": {
    "lint-snap-v2:snap_type_redflag": {
      "manual_review": true,
      "text": "(NEEDS REVIEW) type 'base' not allowed"
    }
  },
  "info": {
    "lint-snap-v2:apps_present": {
      "manual_review": false,
      "text": "OK (optional apps field not specified)"
    },
    "lint-snap-v2:architecture_specified_needed:amd64": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:architecture_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:assumes_valid": {
      "manual_review": false,
      "text": "OK (assumes not specified)"
    },
    "lint-snap-v2:base_interfaces:plugs": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:base_interfaces:slots": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:description_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:grade_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:hooks_present": {
      "manual_review": false,
      "text": "OK (optional hooks field not specified)"
    },
    "lint-snap-v2:iffy_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:name_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:snap_type_valid": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:summary_present": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:title_present": {
      "manual_review": false,
      "text": "OK (optional title field not specified)"
    },
    "lint-snap-v2:unknown_field": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:valid_unicode": {
      "manual_review": false,
      "text": "ok"
    },
    "lint-snap-v2:vcs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "lint-snap-v2:version_valid": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}
= snap.v2_security =
{
  "error": {},
  "info": {
    "security-snap-v2:squashfs_files": {
      "manual_review": false,
      "text": "OK"
    },
    "security-snap-v2:squashfs_repack_checksum": {
      "manual_review": false,
      "text": "OK"
    }
  },
  "warn": {}
}

